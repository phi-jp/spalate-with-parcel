page-index
  div.p32
    h1 {title}

    div.p16
      div.s64.bg-red
    
    div.mb16
      ul.ml32
        li isNode: {isNode}
        li isBrowser: {isBrowser}
        li(each='{item in [1, 2, 3, 4]}') item {item}

    div.mb16
      h2 グループ一覧
      ul.ml32
        li(each='{item in items}')
          a(href='/{item.ref.path}') {item.data.title}

    div.mb16
      img(src='/images/kenkyo.png')

  script.
    this.title = 'Hello, spalate with parcel!';

    this.fetch = async () => {
      var ref = db.collection('groups');
      var ss = await ref.get({source: "cache"});
      
      if (ss.empty) {
        var ss = await ref.get({source: "server"});
      }

      var items = ss.docs.map(doc => {
        return {
          id: doc.id,
          ref: doc.ref,
          data: doc.data(),
        }
      });

      return {
        items,
      };
    };

    this.on('mount', async () => {
      if (!spalate.isBrowser) return ;

      this.title = 'mounted';

      var res = await this.fetch();
      Object.assign(this, res);
      this.update();
    });
